FROM --platform=linux/amd64 debian:11-slim

RUN apt-get update && \
    apt-get install -y \
    php php-curl php-xml composer unzip php-cli php-json php-zip php-ffi jq

WORKDIR /app

RUN echo "ffi.enable=1" >> /etc/php/7.4/cli/conf.d/docker-php-ext-ffi.ini

COPY . .
ARG RELEASE_TAG
ENV RELEASE_TAG=${RELEASE_TAG}

RUN composer install --no-interaction --no-progress --no-scripts

COPY install.sh /usr/local/bin/install.sh
RUN chmod +x /usr/local/bin/install.sh && /usr/local/bin/install.sh
RUN php --version

CMD ["php", "main.php"]
